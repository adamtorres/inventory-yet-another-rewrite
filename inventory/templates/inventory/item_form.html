{% extends "base.html" %}
{% load static %}
{% load widget_tweaks %}

{% block title %}Inventory : {% if object.id %}Edit{% else %}New{% endif %} Item{% endblock %}

{% block breadcrumb %}
    <div><a href="{% url "inventory:item_search" %}">Item Search</a></div>
{% endblock %}

{% block content %}
{# TODO: Popup to create missing Category without leaving this page. #}
{# http://localhost:8000/static/admin/js/admin/RelatedObjectLookups.js #}
<form method="post">
    {% csrf_token %}
    <div>
        {{ form.non_form_errors }}
        {{ form.non_field_errors }}
        {% for hidden_field in form.hidden_fields %}
            {{ hidden_field }}
        {% endfor %}
    </div>
    <div class="form-group">
        <label for="{{ form.name.id_for_label }}">{{ form.name.label }}</label>
        {% render_field form.name placeholder=form.name.label data-bob="hi" %}
        {% for error in form.name.errors %}
            <span class="help-block">{{ error }}</span>
        {% endfor %}
    </div>
    <div class="form-group">
        <label for="{{ form.description.id_for_label }}">{{ form.description.label }}</label>
        {{ form.description }}
        {% for error in form.description.errors %}
            <span class="help-block">{{ error }}</span>
        {% endfor %}
    </div>
    <div class="form-group">
        <label for="{{ form.category.id_for_label }}">{{ form.category.label }}</label>
        {{ form.category }}
        {% for error in form.category.errors %}
            <span class="help-block">{{ error }}</span>
        {% endfor %}
        {% if not popup %}
            {# TODO: popups don't stack.  The category popup closes the item popup without saving it. #}
            <a class="my-pop-up" href="{% url "inventory:category_create" %}"
               data-control="{{ form.category.id_for_label }}" data-refresh-url="{% url "inventory:api_category" %}">
                <img src="{% static "admin/img/icon-addlink.svg" %}" alt="" width="18" height="18">
            </a>
        {% endif %}
    </div>
    <input type="submit" value="Save">
</form>
{% if object.id %}
<div>
    <a href="{% url "inventory:item_detail" pk=object.id %}">Cancel</a>
</div>
{% endif %}
{% if not popup %}
<div>
    <a href="{% url "inventory:item_list" %}">Cancel and go back to list</a>
</div>
{% endif %}
{% endblock %}

{% block body_scripts %}
<script src="{% static "js/popup_create.js" %}"></script>
<script>
// `ready(...)` is in not_jquery.js and is a replacement for jQuery's `$(document).ready(...)`.
ready(popup_create_setup);
</script>
{% endblock %}